{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/astar.ts","webpack:///./src/command.ts","webpack:///./src/config.ts","webpack:///./src/data.ts","webpack:///./src/editmode.ts","webpack:///./src/gameengine.ts","webpack:///./src/index.ts","webpack:///./src/item.ts","webpack:///./src/math.ts","webpack:///./src/npc.ts","webpack:///./src/platform.ts","webpack:///./src/tilemap.ts","webpack:///./src/user.ts"],"names":[],"mappings":"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","file":"bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","export namespace astar {\r\n\r\n    export class Node {\r\n\r\n        x: number;\r\n        y: number;\r\n        f: number;\r\n        g: number;\r\n        h: number;\r\n        walkable: boolean = true;\r\n        parent: Node;\r\n        costMultiplier: number = 1.0;\r\n        inPath: boolean = false;\r\n\r\n        constructor(x: number, y: number) {\r\n            this.x = x;\r\n            this.y = y;\r\n        }\r\n\r\n        toString() {\r\n            if (this.inPath) {\r\n                return \"国\"\r\n            }\r\n            else if (!this.walkable) {\r\n                return \"田\"\r\n            }\r\n            else {\r\n                return \"口\"\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    export class Grid {\r\n\r\n        private _nodes: Node[][];\r\n        private _numCols: number;\r\n        private _numRows: number;\r\n\r\n        constructor(numCols: number, numRows: number) {\r\n            this._numCols = numCols;\r\n            this._numRows = numRows;\r\n            this._nodes = [];\r\n            for (var i: number = 0; i < this._numCols; i++) {\r\n                this._nodes[i] = [];\r\n                for (var j: number = 0; j < this._numRows; j++) {\r\n                    this._nodes[i][j] = new Node(i, j);\r\n                }\r\n            }\r\n        }\r\n\r\n        clear() {\r\n            for (var i: number = 0; i < this._numCols; i++) {\r\n                for (var j: number = 0; j < this._numRows; j++) {\r\n                    const node = this._nodes[i][j];\r\n                    node.f = node.g = node.h = 0;\r\n                    node.inPath = false;\r\n                    node.parent = null;\r\n                }\r\n            }\r\n        }\r\n\r\n        public getNode(x: number, y: number): Node {\r\n            return this._nodes[x][y];\r\n        }\r\n\r\n        public setWalkable(x: number, y: number, value: boolean): void {\r\n            this._nodes[x][y].walkable = value;\r\n        }\r\n\r\n\r\n        public get numCols(): number {\r\n            return this._numCols;\r\n        }\r\n\r\n        public get numRows(): number {\r\n            return this._numRows;\r\n        }\r\n\r\n        public getNeighbors(node: Node): Node[] {\r\n            const result = [];\r\n            const startX = Math.max(0, node.x - 1);\r\n            const endX = Math.min(this.numCols - 1, node.x + 1);\r\n            const startY = Math.max(0, node.y - 1);\r\n            const endY = Math.min(this.numRows - 1, node.y + 1);\r\n            for (let i = startX; i <= endX; i++) {\r\n                for (var j = startY; j <= endY; j++) {\r\n                    result.push(this.getNode(i, j));\r\n                }\r\n            }\r\n            return result;\r\n        }\r\n\r\n        public toString() {\r\n\r\n            var result = \"\";\r\n\r\n            for (var y = 0; y < this._numRows; y++) {\r\n                for (var x = 0; x < this._numCols; x++) {\r\n                    result += this._nodes[x][y].toString();\r\n                }\r\n                result += \"\\n\"\r\n            }\r\n            return result;\r\n        }\r\n\r\n    }\r\n\r\n\r\n    const STRAIGHT_COST = 1;\r\n\r\n    const DIAG_COST = Math.SQRT2;\r\n\r\n    export class FindPath {\r\n\r\n        private _heuristic: Function;\r\n\r\n        manhattan(node: Node, endNode: Node): number {\r\n            const cost = Math.abs(node.x - endNode.x) * STRAIGHT_COST\r\n                + Math.abs(node.y + endNode.y) * STRAIGHT_COST;\r\n            return cost;\r\n        }\r\n\r\n        euclidian(node: Node, endNode: Node): number {\r\n            const dx = node.x - endNode.x;\r\n            const dy = node.y - endNode.y;\r\n            return Math.sqrt(dx * dx + dy * dy) * STRAIGHT_COST;\r\n        }\r\n\r\n\r\n        diagonal(node: Node, endNode: Node): number {\r\n            const dx = Math.abs(node.x - endNode.x);\r\n            const dy = Math.abs(node.y - endNode.y);\r\n            const diag = Math.min(dx, dy);\r\n            const straight = dx + dy;\r\n            return DIAG_COST * diag + STRAIGHT_COST * (straight - 2 * diag);\r\n        }\r\n\r\n        constructor() {\r\n\r\n        }\r\n\r\n        public setHeurisitic(heuristic: Function) {\r\n            this._heuristic = heuristic;\r\n        }\r\n\r\n        public findPath(grid: Grid, startX: number, startY: number, endX: number, endY: number): Node[] {\r\n            grid.clear();\r\n            const startNode = grid.getNode(startX, startY);\r\n            const endNode = grid.getNode(endX, endY);\r\n            startNode.g = 0;\r\n            startNode.h = this._heuristic(startNode, endNode);\r\n            startNode.f = startNode.g + startNode.h;\r\n            const openList = [];\r\n            const closedList = [];\r\n            let currentNode = startNode;\r\n            while (currentNode != endNode) {\r\n                const neighbors = grid.getNeighbors(currentNode);\r\n                for (let i = 0; i < neighbors.length; i++) {\r\n                    const testNode = neighbors[i];\r\n                    if (testNode == currentNode ||\r\n                        !testNode.walkable) {\r\n                        continue;\r\n                    }\r\n                    let cost = STRAIGHT_COST;\r\n                    if (!((currentNode.x == testNode.x) || (currentNode.y == testNode.y))) {\r\n                        cost = DIAG_COST;\r\n                    }\r\n                    const g = currentNode.g + cost * testNode.costMultiplier;\r\n                    const h = this._heuristic(testNode, endNode);\r\n                    const f = g + h;\r\n                    if (openList.indexOf(testNode) >= 0 || closedList.indexOf(testNode) >= 0) {\r\n                        if (testNode.f > f) {\r\n                            testNode.f = f;\r\n                            testNode.g = g;\r\n                            testNode.h = h;\r\n                            testNode.parent = currentNode;\r\n                        }\r\n                        else {\r\n                            //什么也不做\r\n                        }\r\n                    }\r\n                    else {\r\n                        testNode.f = f;\r\n                        testNode.g = g;\r\n                        testNode.h = h;\r\n                        testNode.parent = currentNode;\r\n                        openList.push(testNode);\r\n                    }\r\n                }\r\n                closedList.push(currentNode);\r\n\r\n                if (openList.length == 0) {\r\n                    console.log(\"no path found\");\r\n                    return null;\r\n                }\r\n                openList.sort((a, b) => a.f - b.f);\r\n                currentNode = openList.shift();\r\n            }\r\n            const path = [];\r\n            let nodeInPath = endNode;\r\n            path.push(nodeInPath);\r\n            nodeInPath.inPath = true;\r\n            while (nodeInPath != startNode) {\r\n                nodeInPath = nodeInPath.parent;\r\n                path.unshift(nodeInPath);\r\n                nodeInPath.inPath = true;\r\n            }\r\n            return path;\r\n        }\r\n    }\r\n}\r\n","export class CommandPool {\r\n\r\n\r\n    private _commandList: CommandBase[] = [];\r\n    private currentCommand: CommandBase = null;\r\n\r\n    push(command: CommandBase) {\r\n        if (this.currentCommand) {\r\n            this._commandList = [];\r\n            this.currentCommand.cancel();\r\n            this.currentCommand = null;\r\n        }\r\n        this._commandList.push(command);\r\n    }\r\n\r\n    seriesExecuteAllCommand() {\r\n        this.pickAndExecuteFirstCommand();\r\n    }\r\n\r\n    private pickAndExecuteFirstCommand() {\r\n        if (this.currentCommand) {\r\n            return;\r\n        }\r\n        if (this._commandList.length == 0) {\r\n            return;\r\n        }\r\n        const command = this._commandList.shift();\r\n        this.currentCommand = command;\r\n        command.onFinished = () => {\r\n            this.currentCommand = null;\r\n            this.pickAndExecuteFirstCommand();\r\n        }\r\n        command.execute();\r\n\r\n\r\n\r\n    }\r\n}\r\n\r\nexport abstract class CommandBase {\r\n\r\n\r\n    onFinished: () => void;\r\n\r\n    abstract execute(): void;\r\n\r\n    abstract cancel(): void;\r\n}","export type ItemConfigType = {\r\n    id: number,\r\n    name: string;\r\n    iconName: string;\r\n}\r\n\r\n\r\nexport const itemConfig: ItemConfigType[] = [\r\n    { id: 1, name: '小型治疗药水', iconName: \"assets/item1.png\" },\r\n    { id: 2, name: \"金币\", iconName: \"assets/item2.png\" }\r\n]","\r\nexport type Data_DisplayObject = {\r\n    scripts?: any[]\r\n    id?: string,\r\n    children?: Data_DisplayObject[]\r\n}\r\n\r\nexport const uiPrefabData: Data_DisplayObject = {\r\n    scripts: [\r\n        { scriptName: \"Transform\", x: 0, y: 0, rotation: 0 },\r\n        { scriptName: \"SpriteRenderer\", imageName: \"assets/font.png\" }\r\n    ],\r\n}\r\n\r\nexport const itemPrefab: Data_DisplayObject = {\r\n    scripts: [\r\n        { scriptName: \"Transform\", x: 0, y: 0, rotation: 0 },\r\n        {\r\n            scriptName: \"SpriteRenderer\"\r\n        },\r\n    ]\r\n}","import { core } from \"./gameengine\";\r\nimport { GameObject, Behaviour, Transform, getGameObjectById, createDataFromGameObject } from \"./gameengine\";\r\n\r\nexport class EditorAPI {\r\n\r\n    private scriptsUUIDMap = {};\r\n\r\n    private listener: (data: any) => void;\r\n\r\n    addListener(listener: (data: any) => void) {\r\n        this.listener = listener;\r\n        this.nofityListener();\r\n    }\r\n\r\n    save() {\r\n\r\n        const jsonData = createDataFromGameObject(core.stage.children[0]);\r\n        const content = JSON.stringify(jsonData, null, '\\t');\r\n        return content;\r\n\r\n    }\r\n\r\n    setScriptProperty(scriptUUID: string, property: { name: string, value: any }) {\r\n        const script = this.scriptsUUIDMap[scriptUUID];\r\n        script[property.name] = property.value;\r\n    }\r\n\r\n    nofityListener() {\r\n        if (this.listener) {\r\n            const result = this.getInfo();\r\n            this.listener(result);\r\n        }\r\n    }\r\n\r\n    changeScene(sceneUrl:string) {\r\n        core.loadScene(sceneUrl);\r\n    }\r\n\r\n\r\n    private getInfo() {\r\n        const scriptsUUIDMap = this.scriptsUUIDMap;\r\n        let uuId = 0;\r\n        function getGameObjectInfo(gameObject: GameObject) {\r\n            const name = gameObject.id || \"Unnamed\";\r\n            const children = gameObject.children.map(child => getGameObjectInfo(child));\r\n\r\n            const scripts = gameObject._scripts.map(script => {\r\n                uuId++;\r\n                scriptsUUIDMap[uuId] = script;\r\n                const properties = []\r\n                const serilizeableKeys = script['__proto__'].serilizeableKeys;\r\n                if (serilizeableKeys) {\r\n                    for (let item of serilizeableKeys) {\r\n                        const property = {\r\n                            name: item.key,\r\n                            createPropertyEditor: (host) => {\r\n                                return item.propertyEditorFactory(host, script, item.key);\r\n                            }\r\n                        };\r\n                        properties.push(property)\r\n\r\n                    }\r\n                }\r\n\r\n\r\n                return {\r\n                    name: script.name, properties, uuId\r\n                }\r\n            })\r\n            return { name, children, scripts }\r\n        }\r\n        return getGameObjectInfo(core.stage);\r\n\r\n    }\r\n}\r\n\r\nexport const editorAPI = new EditorAPI();","import { Data_DisplayObject as Data_GameObject } from \"./data\";\r\nimport { editorAPI } from \"./editmode\";\r\nimport { invertMatrix, Matrix, matrixAppendMatrix, Point, pointAppendMatrix } from \"./math\";\r\nimport { getPlatform } from \"./platform\";\r\n\r\n// https://www.w3cschool.cn/html5/q2ybmfle.html\r\n\r\n// 如何实现可复用？ -> 使用组合，而不是继承\r\n\r\nconst cost: MethodDecorator = (target, key, desc: any) => {\r\n    const method = desc.value;\r\n    console.log('装饰器!!!!!')\r\n    desc.value = function () {\r\n        const startTime = Date.now();\r\n        const result = method.apply(this, arguments);\r\n        const endTime = Date.now();\r\n        const cost = endTime - startTime;\r\n        console.log('执行开销', cost);\r\n        return result;\r\n    }\r\n}\r\n\r\nfunction createEditorObject(key, value) {\r\n    const obj = {};\r\n    obj[key] = value;\r\n    return obj;\r\n}\r\n\r\nexport const propertyEditor_Number: PropertyEditorFactory = (host, script, key) => {\r\n\r\n    const value = script[key];\r\n    const obj = createEditorObject(key, value)\r\n    const controller = host.scriptRoot.add(obj, key).step(1)\r\n    controller.onChange(function (value) {\r\n        host.save(key, value);\r\n    });\r\n\r\n    controller.onFinishChange(function (value) {\r\n        host.save(key, value);\r\n    });\r\n};\r\n\r\nexport const propertyEditor_String: PropertyEditorFactory = (host, script, key) => {\r\n    const value = script[key];\r\n    const obj = createEditorObject(key, value)\r\n    const controller = host.scriptRoot.add(obj, key);\r\n    controller.onChange(function (value) {\r\n        host.save(key, value);\r\n    });\r\n\r\n    controller.onFinishChange(function (value) {\r\n        host.save(key, value);\r\n    });\r\n}\r\n\r\nexport const propertyEditor_None: PropertyEditorFactory = (host, script, key) => {\r\n    host.scriptRoot.addFolder(key)\r\n}\r\n\r\n\r\ninterface PropertyEditorHost {\r\n\r\n    /**\r\n     * 通知编辑器保存该属性\r\n     */\r\n    save: (name: string, value: any) => void\r\n\r\n    /**\r\n     * 编辑器的脚本UI扩展口\r\n     */\r\n    scriptRoot: any;\r\n\r\n}\r\n\r\ntype PropertyEditorFactory = (\r\n    host: PropertyEditorHost,\r\n    script: Behaviour,\r\n    key: string) => void\r\n\r\n\r\nexport const SerilizeField = (propertyEditorFactory: PropertyEditorFactory) => (target, key) => {\r\n\r\n\r\n    const clz = target as any;\r\n    if (!clz.serilizeableKeys) {\r\n        clz.serilizeableKeys = [];\r\n    }\r\n\r\n\r\n    clz.serilizeableKeys.push({\r\n        key, propertyEditorFactory\r\n    });\r\n}\r\n\r\nexport abstract class Behaviour {\r\n\r\n    constructor() {\r\n        this.name = this.constructor.name;\r\n    }\r\n\r\n    name: string;\r\n\r\n    displayObject: GameObject;\r\n\r\n    abstract onStart();\r\n\r\n    onEditorUpdate() {\r\n    }\r\n\r\n    abstract onUpdate();\r\n\r\n}\r\n\r\nexport abstract class RenderableBehaviour extends Behaviour {\r\n\r\n    onRender(context: CanvasRenderingContext2D) {\r\n\r\n    }\r\n\r\n    getRenderArea(): { x: number, y: number, width: number, height: number } {\r\n        return null;\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class GameObject {\r\n\r\n\r\n    id: string;\r\n\r\n    alpha: number = 1;\r\n\r\n    private globalAlpha: number = 1;\r\n\r\n    parent: GameObject;\r\n\r\n    private isStage: boolean = false;\r\n\r\n    children: GameObject[] = [];\r\n\r\n    renderNode: RenderableBehaviour;\r\n\r\n\r\n\r\n    constructor(isStage: boolean = false) {\r\n        this.isStage = isStage;\r\n        const hitTestScript = new HitTestScript();\r\n        this.addScript(hitTestScript);\r\n    }\r\n\r\n    addChild(displayObject: GameObject) {\r\n        this.children.push(displayObject);\r\n        displayObject.parent = this;\r\n        editorAPI.nofityListener();\r\n    }\r\n\r\n    removeChild(displayObject: GameObject) {\r\n        const index = this.children.indexOf(displayObject);\r\n        this.children.splice(index, 1);\r\n        editorAPI.nofityListener();\r\n    }\r\n\r\n\r\n    _scripts: Behaviour[] = [];\r\n\r\n    addScript(script: Behaviour) {\r\n        script.displayObject = this;\r\n        this._scripts.push(script);\r\n        script.onStart();\r\n    }\r\n\r\n    /**\r\n     * T 是一个泛型\r\n     */\r\n    getScript<T extends Behaviour>(clz: { new(): T }): T {\r\n        for (let script of this._scripts) {\r\n            if (script.constructor === clz) {\r\n                return script as T;\r\n            }\r\n        }\r\n        return null;\r\n    }\r\n\r\n\r\n    onUpdate() {\r\n        for (let script of this._scripts) {\r\n            script.onUpdate();\r\n        }\r\n        for (let child of this.children) {\r\n            child.onUpdate();\r\n        }\r\n    }\r\n\r\n    onEditorUpdate() {\r\n        for (let script of this._scripts) {\r\n            script.onEditorUpdate();\r\n        }\r\n        for (let child of this.children) {\r\n            child.onEditorUpdate();\r\n        }\r\n    }\r\n\r\n    draw(context: CanvasRenderingContext2D) {\r\n        const globalMatrix = this.getScript(Transform).globalMatrix\r\n        if (!this.isStage) {\r\n            this.globalAlpha = this.alpha * this.parent.globalAlpha;\r\n        }\r\n        context.globalAlpha = this.globalAlpha;\r\n        context.setTransform(\r\n            globalMatrix.a,\r\n            globalMatrix.b,\r\n            globalMatrix.c,\r\n            globalMatrix.d,\r\n            globalMatrix.tx,\r\n            globalMatrix.ty\r\n        )\r\n        if (this.renderNode) {\r\n            this.renderNode.onRender(context);\r\n        }\r\n        for (let child of this.children) {\r\n            child.draw(context);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class SpriteRenderer extends RenderableBehaviour {\r\n\r\n    @SerilizeField(propertyEditor_String)\r\n    imageName: string;\r\n\r\n    onStart() {\r\n        this.displayObject.renderNode = this;\r\n    }\r\n\r\n    onUpdate() {\r\n    }\r\n\r\n    onRender(context: CanvasRenderingContext2D) {\r\n        if (this.imageName) {\r\n            const image = getImage(this.imageName);\r\n            context.drawImage(image, 0, 0);\r\n        }\r\n    }\r\n\r\n    getRenderArea() {\r\n        if (this.imageName) {\r\n            const image = getImage(this.imageName);\r\n            return { x: 0, y: 0, width: image.width, height: image.height }\r\n        }\r\n        return null;\r\n    }\r\n\r\n}\r\n\r\n\r\nexport class TextRenderer extends RenderableBehaviour {\r\n\r\n\r\n    @SerilizeField(propertyEditor_String)\r\n    text: string = \"\";\r\n\r\n    @SerilizeField(propertyEditor_Number)\r\n    fontSize: number = 24;\r\n\r\n    onStart() {\r\n        this.displayObject.renderNode = this;\r\n    }\r\n\r\n    onUpdate() {\r\n\r\n    }\r\n\r\n    onRender(context: CanvasRenderingContext2D) {\r\n        const lines = this.text.split(\"\\n\");\r\n        context.font = this.fontSize + 'px Arial'\r\n        context.fillStyle = '#FF0000';\r\n        let lineCount = 0;\r\n        for (let line of lines) {\r\n            lineCount++;\r\n            context.fillText(line, 0, this.fontSize * lineCount);\r\n        }\r\n    }\r\n\r\n    getRenderArea() {\r\n        return { x: 0, y: 0, width: 100, height: 20 };\r\n    }\r\n}\r\n\r\nconst images: { [url: string]: HTMLImageElement } = {};\r\n\r\nexport function getImage(url: string) {\r\n    return images[url];\r\n}\r\n\r\nexport class GameEngineCore {\r\n\r\n    private canvas: HTMLCanvasElement;\r\n    private context: CanvasRenderingContext2D;\r\n\r\n    stage = new GameObject(true);\r\n\r\n    constructor() {\r\n        this.canvas = getPlatform().getMainCanvas();\r\n        this.context = this.canvas.getContext(\"2d\");\r\n        this.stage.addScript(new Transform())\r\n    }\r\n\r\n    loadImage(url: string) {\r\n        const img = document.createElement(\"img\");\r\n        img.src = url;\r\n        images[url] = img;\r\n    }\r\n\r\n    private currentScene: GameObject;\r\n\r\n    loadScene(sceneUrl: string) {\r\n\r\n        getPlatform().loadText(sceneUrl,(text)=>{\r\n            const json = JSON.parse(text);\r\n            this.createScene(json);\r\n        })\r\n\r\n      \r\n    }\r\n\r\n    createScene(data: Data_GameObject) {\r\n        if (this.currentScene) {\r\n            this.stage.removeChild(this.currentScene);\r\n        }\r\n        const rootDisplayObject = createGameObject(data)\r\n        this.stage.addChild(rootDisplayObject);\r\n        this.currentScene = rootDisplayObject;\r\n    }\r\n\r\n    createPrefab(data: Data_GameObject) {\r\n        const gameObject = createGameObject(data);\r\n        return gameObject;\r\n    }\r\n\r\n    start() {\r\n        this.executeFrame();\r\n\r\n        getPlatform().listenTouchEvent((clickX:number,clickY:number)=>{\r\n            const hitTestScript = this.stage.getScript(HitTestScript);\r\n            const hitTestDisplayObject = hitTestScript.hitTest(clickX, clickY)\r\n            let displayObject = hitTestDisplayObject;\r\n            while (displayObject) {\r\n                const hitTestScript = displayObject.getScript(HitTestScript);\r\n                if (hitTestScript && hitTestScript.onClick) {\r\n                    hitTestScript.onClick(hitTestScript.clickLocalX, hitTestScript.clickLocalY);\r\n                }\r\n                displayObject = displayObject.parent;\r\n            }\r\n        })\r\n    }\r\n\r\n    executeFrame() {\r\n        requestAnimationFrame(this.executeFrame.bind(this));\r\n        this.update();\r\n    }\r\n\r\n\r\n\r\n    /**\r\n     * 游戏引擎心跳控制\r\n     * - 清除屏幕\r\n     * - 执行用户逻辑\r\n     * - 执行渲染\r\n     */\r\n    update() {\r\n        this.clearScreen();\r\n        this.executeUserLogic();\r\n        this.drawRenderList();\r\n    }\r\n\r\n    private clearScreen() {\r\n        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height)\r\n    }\r\n\r\n    private drawRenderList() {\r\n        this.context.save();\r\n        this.stage.draw(this.context);\r\n        this.context.restore();\r\n    }\r\n\r\n    private executeUserLogic() {\r\n        if (isEditorMode()) {\r\n            this.stage.onEditorUpdate();\r\n        }\r\n        else {\r\n            this.stage.onUpdate();\r\n        }\r\n    }\r\n}\r\n\r\n\r\n\r\nconst ids: { [id: string]: GameObject } = {};\r\n\r\nexport function getGameObjectById(id: string) {\r\n    return ids[id];\r\n}\r\n\r\n\r\nexport function createDataFromGameObject(gameObject: GameObject): Data_GameObject {\r\n    const json: Data_GameObject = {};\r\n    if (gameObject.id) {\r\n        json.id = gameObject.id;\r\n    }\r\n    if (gameObject.children) {\r\n        json.children = [];\r\n        for (let child of gameObject.children) {\r\n            const dataChild = createDataFromGameObject(child);\r\n            json.children.push(dataChild);\r\n        }\r\n    }\r\n    if (gameObject._scripts) {\r\n        json.scripts = [];\r\n        for (let script of gameObject._scripts) {\r\n            const scriptName = script.constructor.name;\r\n            if (scriptName === 'HitTestScript') {\r\n                continue;\r\n            }\r\n            const serilizedData = {\r\n                scriptName: script.constructor.name\r\n            };\r\n            const serilizeableKeys = script['__proto__'].serilizeableKeys;\r\n            if (serilizeableKeys) {\r\n                for (let item of serilizeableKeys) {\r\n                    serilizedData[item.key] = script[item.key];\r\n                }\r\n            }\r\n            json.scripts.push(serilizedData);\r\n\r\n        }\r\n    }\r\n    return json;\r\n}\r\n\r\nexport function createGameObject(data: Data_GameObject): GameObject {\r\n\r\n    const gameObject = new GameObject();\r\n    if (data.id) {\r\n        ids[data.id] = gameObject;\r\n        gameObject.id = data.id;\r\n    }\r\n    if (data.children) {\r\n        for (let childData of data.children) {\r\n            const child = createGameObject(childData);\r\n            if (child) {\r\n                gameObject.addChild(child);\r\n            }\r\n        }\r\n    }\r\n    if (data.scripts) {\r\n        for (let scriptData of data.scripts) {\r\n            const script = createScript(scriptData);\r\n            const serilizeableKeys = script['__proto__'].serilizeableKeys\r\n            if (serilizeableKeys) {\r\n                for (let item of serilizeableKeys) {\r\n                    script[item.key] = scriptData[item.key];\r\n                }\r\n            }\r\n            gameObject.addScript(script);\r\n        }\r\n    }\r\n    return gameObject;\r\n}\r\n\r\n\r\nlet scriptMap = {\r\n\r\n}\r\n\r\n/**\r\n * 里式替换法则\r\n */\r\nexport function registerScript(scriptClass: typeof Behaviour) {\r\n    scriptMap[scriptClass.name] = scriptClass\r\n}\r\n\r\n\r\nfunction createScript(data: any): Behaviour {\r\n    const scriptName = data.scriptName;\r\n    const clz = scriptMap[scriptName];\r\n    const script = new clz();\r\n    return script;\r\n}\r\n\r\nconsole.log('before Transform')\r\nexport class Transform extends Behaviour {\r\n\r\n    @SerilizeField(propertyEditor_Number)\r\n    x: number = 0;\r\n\r\n    @SerilizeField(propertyEditor_Number)\r\n    y: number = 0;\r\n\r\n    scaleX: number = 1;\r\n    scaleY: number = 1;\r\n\r\n    @SerilizeField(propertyEditor_Number)\r\n    rotation: number = 0;\r\n\r\n    localMatrix: Matrix = new Matrix();\r\n    globalMatrix: Matrix = new Matrix();\r\n\r\n    onStart() {\r\n    }\r\n\r\n    onEditorUpdate() {\r\n        this.onUpdate();\r\n    }\r\n\r\n    onUpdate() {\r\n        this.localMatrix.updateFromDisplayObject(this.x, this.y, this.scaleX, this.scaleY, this.rotation);\r\n        const parent = this.displayObject.parent;\r\n        if (parent) {\r\n            const parentTransform = this.displayObject.parent.getScript(Transform);\r\n            this.globalMatrix = matrixAppendMatrix(this.localMatrix, parentTransform.globalMatrix);\r\n        }\r\n    }\r\n}\r\n\r\nconsole.log('after Transform')\r\n\r\nexport class HitTestScript extends Behaviour {\r\n\r\n    onClick: (localX: number, localY: number) => void;\r\n\r\n    private clickLocalX: number;\r\n    private clickLocalY: number;\r\n\r\n    hitTestArea = { x: 0, y: 0, width: 100, height: 100 };\r\n\r\n\r\n    hitTest(clickLocalX: number, clickLocalY: number) {\r\n        this.clickLocalX = clickLocalX;\r\n        this.clickLocalY = clickLocalY;\r\n        const displayObject = this.displayObject;\r\n        const length = displayObject.children.length - 1;\r\n        for (let i = length; i >= 0; i--) {\r\n            const child = displayObject.children[i];\r\n            const localMatrix = child.getScript(Transform).localMatrix;\r\n            const invertLocalMatrix = invertMatrix(localMatrix);\r\n            const clickLocalPoint = new Point(clickLocalX, clickLocalY);\r\n            //相对于子对象的相对坐标 = 相对于当前对象的相对坐标 * 子对象的相对矩阵的逆矩阵\r\n            const childLocalPoint = pointAppendMatrix(clickLocalPoint, invertLocalMatrix);\r\n            const childHitTestScript = child.getScript(HitTestScript);\r\n            const result = childHitTestScript.hitTest(childLocalPoint.x, childLocalPoint.y);\r\n            if (result) {\r\n                return result;\r\n            }\r\n        }\r\n\r\n        const renderNode = this.displayObject.renderNode;\r\n        if (renderNode) {\r\n            const renderArea = renderNode.getRenderArea();\r\n            if (renderArea) {\r\n                if (clickLocalX >= 0 && clickLocalX <= renderArea.width &&\r\n                    clickLocalY >= 0 && clickLocalY <= renderArea.height) {\r\n                    return displayObject;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            }\r\n            return null;\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n\r\n    onStart() {\r\n    }\r\n\r\n    onUpdate() {\r\n    }\r\n\r\n}\r\n\r\nregisterScript(Transform);\r\nregisterScript(HitTestScript);\r\nregisterScript(SpriteRenderer);\r\nregisterScript(TextRenderer);\r\n\r\n\r\nexport function isEditorMode() {\r\n   return getPlatform().isEditorMode();\r\n}\r\n\r\nwindow['editorAPI'] = editorAPI;\r\nexport const core = new GameEngineCore();\r\n\r\n","import { astar } from \"./astar\";\r\nimport { CommandBase, CommandPool } from \"./command\";\r\nimport { uiPrefabData } from \"./data\";\r\nimport { Behaviour, GameEngineCore, GameObject, getGameObjectById, HitTestScript, registerScript, TextRenderer, Transform, isEditorMode, core } from \"./gameengine\";\r\nimport { ItemLayerBehaviour, UseItemCommand } from \"./item\";\r\nimport { NpcBehaviour } from \"./npc\";\r\nimport { TileMapRenderer } from \"./tilemap\";\r\nimport { user } from \"./user\";\r\n\r\nexport class WalkableBehaviour extends Behaviour {\r\n\r\n    private path: { x: number, y: number }[] = [];\r\n\r\n    private speedY: number = 0;\r\n    private speedX: number = 0;\r\n\r\n    private pathIndex = 0;\r\n\r\n    onFinished: Function;\r\n\r\n    onStart() {\r\n    }\r\n\r\n    setStartPosition(startX: number, startY: number) {\r\n        const transform = this.displayObject.getScript(Transform);\r\n        transform.x = startX;\r\n        transform.y = startY;\r\n    }\r\n\r\n    goto(path: { x: number, y: number }[]) {\r\n        this.path = path;\r\n        this.pathIndex = 0;\r\n\r\n    }\r\n\r\n    onUpdate() {\r\n        if (!this.path[this.pathIndex]) {\r\n            return;\r\n        }\r\n        const transform = this.displayObject.getScript(Transform);\r\n\r\n        const targetX = this.path[this.pathIndex].x;\r\n        const targetY = this.path[this.pathIndex].y;\r\n        if (transform.y === targetY) {\r\n            this.speedY = 0;\r\n        }\r\n        else if (transform.y < targetY) {\r\n            this.speedY = 1;\r\n        }\r\n        else {\r\n            this.speedY = -1;\r\n        }\r\n        if (transform.x === targetX) {\r\n            this.speedX = 0;\r\n        }\r\n        else if (transform.x < targetX) {\r\n            this.speedX = 1;\r\n        }\r\n        else {\r\n            this.speedX = -1;\r\n        }\r\n\r\n\r\n        const arrivedSingleTarget = transform.x === targetX && transform.y === targetY;\r\n        if (arrivedSingleTarget) {\r\n            this.pathIndex++;\r\n            if (this.pathIndex >= this.path.length) {\r\n                if (this.onFinished) {\r\n                    this.onFinished();\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n        transform.x += this.speedX;\r\n        transform.y += this.speedY;\r\n    }\r\n\r\n}\r\n\r\n\r\nclass WalkCommand extends CommandBase {\r\n\r\n    private walkable: WalkableBehaviour;\r\n    private tileX: number;\r\n    private tileY: number;\r\n    constructor(walkable: WalkableBehaviour, tileX: number, tileY: number) {\r\n        super();\r\n        this.walkable = walkable;\r\n        this.tileX = tileX;\r\n        this.tileY = tileY;\r\n    }\r\n\r\n    execute() {\r\n\r\n        const findpath = new astar.FindPath();\r\n        const tilemap = getGameObjectById(\"tilemap\");\r\n        const grid = tilemap.getScript(TileMapRenderer).grid;\r\n        findpath.setHeurisitic(findpath.euclidian);\r\n        const transform = this.walkable.displayObject.getScript(Transform);\r\n        const startX = Math.floor(transform.x / 64);\r\n        const startY = Math.floor(transform.y / 64);\r\n\r\n        const paths = findpath.findPath(grid, startX, startY, this.tileX, this.tileY);\r\n        if (paths) {\r\n            const path = paths.map(node => {\r\n                return { x: node.x * 64, y: node.y * 64 }\r\n            });\r\n            path.shift();\r\n            this.walkable.onFinished = () => {\r\n                this.onFinished();\r\n            }\r\n            this.walkable.goto(path);\r\n        }\r\n        else {\r\n            this.onFinished();\r\n        }\r\n\r\n    }\r\n\r\n    cancel(): void {\r\n        console.log('取消移动')\r\n    }\r\n}\r\n\r\nclass TalkCommand extends CommandBase {\r\n    private ui: GameObject;\r\n    execute(): void {\r\n        const ui = core.createPrefab(uiPrefabData);\r\n        const uiRoot = getGameObjectById(\"UIRoot\");\r\n        uiRoot.getScript(HitTestScript).onClick = () => {\r\n            uiRoot.removeChild(ui);\r\n            this.onFinished();\r\n        };\r\n        uiRoot.addChild(ui);\r\n        this.ui = ui;\r\n    }\r\n\r\n    cancel() {\r\n        const uiRoot = getGameObjectById(\"UIRoot\");\r\n        uiRoot.removeChild(this.ui);\r\n    }\r\n\r\n}\r\n\r\nexport class MainRoleBehaviour extends Behaviour {\r\n\r\n    private commandPool = new CommandPool();\r\n\r\n\r\n    private goto(tileX: number, tileY: number) {\r\n        const walkable = this.displayObject.getScript(WalkableBehaviour)\r\n        const walkCommand1 = new WalkCommand(walkable, tileX, tileY);\r\n        this.commandPool.push(walkCommand1);\r\n\r\n\r\n\r\n        const itemLayer = getGameObjectById('itemLayer');\r\n        const itemLayerBehaviour = itemLayer.getScript(ItemLayerBehaviour);\r\n        const item = itemLayerBehaviour.getItemByTileXY(tileX, tileY);\r\n        if (item) {\r\n            const useItemCommand = new UseItemCommand(item);\r\n            this.commandPool.push(useItemCommand);\r\n        }\r\n        else {\r\n            const talkCommand = new TalkCommand();\r\n            this.commandPool.push(talkCommand);\r\n        }\r\n\r\n        // const walkCommand2 = new WalkCommand(walkable, 0, 0);\r\n\r\n        // this.commandPool.push(talkCommand);\r\n\r\n        // this.commandPool.push(walkCommand2);\r\n        this.commandPool.seriesExecuteAllCommand();\r\n\r\n    }\r\n\r\n    onStart() {\r\n        const tilemap = getGameObjectById(\"tilemap\");\r\n        const hitTest = tilemap.getScript(HitTestScript);\r\n        hitTest.onClick = (localX, localY) => {\r\n            const tileX = Math.floor(localX / 64);\r\n            const tileY = Math.floor(localY / 64);\r\n            this.goto(tileX, tileY);\r\n        }\r\n\r\n    }\r\n    onUpdate() {\r\n\r\n    }\r\n}\r\n\r\n\r\n\r\nexport class TopUIBehaviour extends Behaviour {\r\n    onStart() {\r\n\r\n    }\r\n    onUpdate() {\r\n        const text = this.displayObject.getScript(TextRenderer);\r\n        text.text = user.gold.toString();\r\n    }\r\n}\r\n\r\nregisterScript(TileMapRenderer);\r\nregisterScript(MainRoleBehaviour);\r\nregisterScript(WalkableBehaviour);\r\nregisterScript(NpcBehaviour);\r\nregisterScript(ItemLayerBehaviour);\r\nregisterScript(TopUIBehaviour)\r\n\r\n\r\ncore.loadImage(\"assets/icon.jpg\");\r\ncore.loadImage(\"assets/font.png\");\r\ncore.loadImage(\"assets/0.png\");\r\ncore.loadImage(\"assets/1.png\");\r\ncore.loadImage(\"assets/item1.png\");\r\ncore.loadImage(\"assets/item2.png\");\r\ncore.loadImage(\"assets/enermy.jpg\");\r\ncore.loadImage(\"assets/conversation.png\");\r\n\r\ncore.start();\r\n\r\nif (!isEditorMode()) {\r\n    core.loadScene('assets/game.scene.json')\r\n}\r\n\r\n","import { Behaviour, GameObject, Transform, SpriteRenderer, isEditorMode, SerilizeField, propertyEditor_None } from \"./gameengine\";\r\nimport { core } from \"./gameengine\";\r\nimport { itemPrefab } from \"./data\";\r\nimport { CommandBase } from \"./command\";\r\nimport { user } from \"./user\";\r\nimport { ItemConfigType, itemConfig } from \"./config\";\r\n\r\nexport class ItemLayerBehaviour extends Behaviour {\r\n\r\n\r\n    private items: Item[] = [];\r\n    @SerilizeField(propertyEditor_None)\r\n    private itemData: any[];\r\n\r\n    onStart() {\r\n\r\n        if (!isEditorMode()) {\r\n            for (let itemData of this.itemData) {\r\n                const itemGameObject = core.createPrefab(itemPrefab);\r\n                const transform = itemGameObject.getScript(Transform);\r\n                const cId = itemData.cId;\r\n\r\n                transform.x = itemData.x * 64;\r\n                transform.y = itemData.y * 64;\r\n                let gameItem: Item;\r\n                if (cId == 1) {\r\n                    gameItem = new HpItem(cId);\r\n                }\r\n                else if (cId == 2) {\r\n                    gameItem = new GoldItem(cId);\r\n                }\r\n                if (gameItem) {\r\n                    gameItem.x = itemData.x;\r\n                    gameItem.y = itemData.y;\r\n                    gameItem.cId = itemData.cId;\r\n                    gameItem.uId = itemData.uId;\r\n                    const spriteRenderer = itemGameObject.getScript(SpriteRenderer);\r\n                    spriteRenderer.imageName = gameItem.config.iconName;\r\n                    this.items.push(gameItem);\r\n                    gameItem.itemGameObject = itemGameObject;\r\n                }\r\n                this.displayObject.addChild(itemGameObject);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    onUpdate() {\r\n    }\r\n\r\n    getItemByTileXY(tileX: number, tileY: number): Item {\r\n        const result = this.items.find(item => item.x === tileX && item.y === tileY);\r\n        if (result) {\r\n            return result;\r\n        }\r\n        else {\r\n            return null;\r\n        }\r\n    }\r\n}\r\n\r\nexport abstract class Item {\r\n\r\n    uId: number;\r\n    cId: number;\r\n    x: number;\r\n    y: number;\r\n    itemGameObject: GameObject;\r\n    config: ItemConfigType;\r\n\r\n    constructor(cId: number) {\r\n        this.config = itemConfig.find(config => config.id === cId);\r\n    }\r\n\r\n    /**\r\n     * 使用一个道具，如果使用完需要消失，返回true,否则返回 false\r\n     */\r\n    use(): boolean {\r\n\r\n        return false;\r\n    }\r\n}\r\n\r\nexport class HpItem extends Item {\r\n\r\n    use() {\r\n        console.log(`你使用了${this.config.name}`);\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\nexport class GoldItem extends Item {\r\n\r\n    use() {\r\n        user.gold += 100;\r\n        return true;\r\n    }\r\n}\r\n\r\n\r\nexport class UseItemCommand extends CommandBase {\r\n\r\n    private item: Item;\r\n    constructor(item: Item) {\r\n        super();\r\n        this.item = item;\r\n    }\r\n\r\n    execute() {\r\n        const needDisappear = this.item.use();\r\n        if (needDisappear) {\r\n            const gameObject = this.item.itemGameObject;\r\n            gameObject.parent.removeChild(gameObject);\r\n        }\r\n\r\n\r\n        this.onFinished();\r\n    }\r\n\r\n    cancel() {\r\n\r\n    }\r\n}","\r\n\r\n/**\r\n * 数学相关类，由于本引擎是一个 2D 游戏引擎，所以内置的 Point 只有 x,y 两个属性，并且矩阵是个 3*3 矩阵\r\n * 扩展阅读：矩阵运算的几何意义是什么？ \r\n * https://www.zhihu.com/question/21351965/answer/204058188\r\n */\r\n\r\n\r\n/**\r\n * 表示一个点，也等价于一个二维向量\r\n */\r\nexport class Point {\r\n    x: number;\r\n    y: number;\r\n    constructor(x: number, y: number) {\r\n        this.x = x;\r\n        this.y = y;\r\n    }\r\n}\r\n\r\n/**\r\n * \r\n * @param point 矩阵与向量相乘\r\n */\r\nexport function pointAppendMatrix(point: Point, m: Matrix): Point {\r\n    var x = m.a * point.x + m.c * point.y + m.tx;\r\n    var y = m.b * point.x + m.d * point.y + m.ty;\r\n    return new Point(x, y);\r\n\r\n}\r\n\r\n/**\r\n * 使用伴随矩阵法求逆矩阵\r\n * http://wenku.baidu.com/view/b0a9fed8ce2f0066f53322a9\r\n */\r\nexport function invertMatrix(m: Matrix): Matrix {\r\n\r\n\r\n    var a = m.a;\r\n    var b = m.b;\r\n    var c = m.c;\r\n    var d = m.d;\r\n    var tx = m.tx;\r\n    var ty = m.ty;\r\n\r\n    var determinant = a * d - b * c;\r\n    var result = new Matrix(1, 0, 0, 1, 0, 0);\r\n    if (determinant == 0) {\r\n        throw new Error(\"no invert\");\r\n    }\r\n\r\n    determinant = 1 / determinant;\r\n    var k = result.a = d * determinant;\r\n    b = result.b = -b * determinant;\r\n    c = result.c = -c * determinant;\r\n    d = result.d = a * determinant;\r\n    result.tx = -(k * tx + c * ty);\r\n    result.ty = -(b * tx + d * ty);\r\n    return result;\r\n\r\n}\r\n\r\n/**\r\n * \r\n * 矩阵与矩阵相乘\r\n */\r\nexport function matrixAppendMatrix(m1: Matrix, m2: Matrix): Matrix {\r\n\r\n    var result = new Matrix();\r\n    result.a = m1.a * m2.a + m1.b * m2.c;\r\n    result.b = m1.a * m2.b + m1.b * m2.d;\r\n    result.c = m2.a * m1.c + m2.c * m1.d;\r\n    result.d = m2.b * m1.c + m1.d * m2.d;\r\n    result.tx = m2.a * m1.tx + m2.c * m1.ty + m2.tx;\r\n    result.ty = m2.b * m1.tx + m2.d * m1.ty + m2.ty;\r\n    return result;\r\n}\r\n\r\nvar PI = Math.PI;\r\nvar HalfPI = PI / 2;\r\nvar PacPI = PI + HalfPI;\r\nvar TwoPI = PI * 2;\r\nvar DEG_TO_RAD: number = Math.PI / 180;\r\n\r\n\r\n\r\n\r\n\r\nexport class Matrix {\r\n\r\n    constructor(a: number = 1, b: number = 0, c: number = 0, d: number = 1, tx: number = 0, ty: number = 0) {\r\n        this.a = a;\r\n        this.b = b;\r\n        this.c = c;\r\n        this.d = d;\r\n        this.tx = tx;\r\n        this.ty = ty;\r\n    }\r\n\r\n\r\n    public a: number;\r\n\r\n    public b: number;\r\n\r\n    public c: number;\r\n\r\n    public d: number;\r\n\r\n    public tx: number;\r\n\r\n    public ty: number;\r\n\r\n\r\n    /**\r\n     * 返回将 Matrix 对象表示的几何转换应用于指定点所产生的结果。\r\n     */\r\n    public toString(): string {\r\n        return \"(a=\" + this.a + \", b=\" + this.b + \", c=\" + this.c + \", d=\" + this.d + \", tx=\" + this.tx + \", ty=\" + this.ty + \")\";\r\n    }\r\n\r\n    /**\r\n     * 根据显示对象的属性确定当前矩阵\r\n     */\r\n    updateFromDisplayObject(x: number, y: number, scaleX: number, scaleY: number, rotation: number) {\r\n\r\n        this.tx = x;\r\n        this.ty = y;\r\n\r\n        var skewX, skewY;\r\n        skewX = skewY = rotation / 180 * Math.PI;;\r\n\r\n        if ((skewX == 0 || skewX == TwoPI) && (skewY == 0 || skewY == TwoPI)) {\r\n            this.a = scaleX;\r\n            this.b = this.c = 0;\r\n            this.d = scaleY;\r\n            return;\r\n        }\r\n\r\n        var u = Math.cos(skewX);\r\n        var v = Math.sin(skewX);\r\n        if (skewX == skewY) {\r\n            this.a = u * scaleX;\r\n            this.b = v * scaleX;\r\n        } else {\r\n            this.a = Math.cos(skewY) * scaleX;\r\n            this.b = Math.sin(skewY) * scaleX;\r\n        }\r\n        this.c = -v * scaleY;\r\n        this.d = u * scaleY;\r\n\r\n    }\r\n}","import { Behaviour, getGameObjectById, SerilizeField, propertyEditor_None } from \"./gameengine\";\r\nimport { WalkableBehaviour } from \".\";\r\n\r\n\r\nexport class NpcBehaviour extends Behaviour {\r\n    @SerilizeField(propertyEditor_None)\r\n    private patrol: { x: number, y: number }[] = [];\r\n    onStart() {\r\n        const walkable = this.displayObject.getScript(WalkableBehaviour);\r\n        walkable.goto(this.patrol.map(node => {\r\n            return {\r\n                x: node.x * 64,\r\n                y: node.y * 64\r\n            }\r\n        }));\r\n        walkable.onFinished = () => {\r\n            this.patrol = this.patrol.reverse();\r\n            console.log(this.patrol)\r\n            walkable.goto(this.patrol.map(node => {\r\n                return {\r\n                    x: node.x * 64,\r\n                    y: node.y * 64\r\n                }\r\n            }));\r\n        }\r\n        // const npcBehaviour = getGameObjectById(\"npcLayer\").getScript(NPCLayerBehaviour);\r\n        // npcBehaviour.addNPC(this);\r\n    }\r\n    onUpdate() {\r\n\r\n    }\r\n}\r\n\r\nexport class NPCLayerBehaviour extends Behaviour {\r\n\r\n\r\n    private npcs: NpcBehaviour[] = [];\r\n    addNPC(npc: NpcBehaviour) {\r\n        this.npcs.push(npc);\r\n    }\r\n\r\n    getNPCBYTileXY(tileX: number, tileY: number) {\r\n\r\n    }\r\n\r\n    onStart() {\r\n    }\r\n    onUpdate() {\r\n    }\r\n}","let platform:Platform;\r\n\r\nexport function getPlatform() {\r\n    if (platform) {\r\n        return platform;\r\n    }\r\n    if (window['canvas']) {\r\n        platform = new WxgamePlatform();\r\n    }\r\n    else {\r\n        platform = new BrowserPlatform();\r\n    }\r\n    return platform;\r\n}\r\n\r\n\r\nabstract class Platform {\r\n\r\n    abstract loadText(url: string, callback: Function): void;\r\n\r\n    abstract getMainCanvas(): HTMLCanvasElement;\r\n\r\n    abstract isEditorMode():boolean;\r\n\r\n    abstract listenTouchEvent(callback):void;\r\n}\r\n\r\n\r\nclass BrowserPlatform extends Platform {\r\n    listenTouchEvent(callback: any): void {\r\n        const canvas = this.getMainCanvas();\r\n        canvas.onclick = (e) => {\r\n            console.log ('helloworld')\r\n            const rect = canvas.getBoundingClientRect();\r\n            const clickX = Math.round(e.clientX - rect.left);\r\n            const clickY = Math.round(e.clientY - rect.top);\r\n            callback(clickX,clickY);\r\n        }\r\n    }\r\n    isEditorMode(): boolean {\r\n        return location.search.indexOf(\"editorMode=1\") >= 0;\r\n    }\r\n    getMainCanvas(): HTMLCanvasElement {\r\n        return document.getElementById(\"gameCanvas\") as HTMLCanvasElement;\r\n    }\r\n    loadText(url: string, callback: Function): void {\r\n        const xhr = new XMLHttpRequest();\r\n        xhr.onload = () => {\r\n            callback(xhr.responseText);\r\n        }\r\n        xhr.open(\"get\", url);\r\n        xhr.send();\r\n    }\r\n\r\n}\r\n\r\nclass WxgamePlatform extends Platform {\r\n\r\n    private scale:number = 1;\r\n    listenTouchEvent(callback: any): void {\r\n        wx.onTouchStart(result => {\r\n            const touch = result.touches[0]\r\n            const clientX = touch.clientX / this.scale;\r\n            const clientY = touch.clientY / this.scale\r\n            console.log (clientX,clientY,this.scale)\r\n            callback(clientX,clientY);\r\n          })\r\n    }\r\n    isEditorMode(): boolean {\r\n        return false;\r\n    }\r\n    getMainCanvas(): HTMLCanvasElement {\r\n        const canvas = window['canvas'];\r\n        const width = canvas.width;\r\n        const height = canvas.height;\r\n        const scale = width / height;\r\n        canvas.width = 600;\r\n        canvas.height = Math.floor(600 / scale);\r\n        this.scale = scale;\r\n        return canvas\r\n    }\r\n    loadText(url: string, callback: Function): void {\r\n        const fs = wx.getFileSystemManager()\r\n        const content = fs.readFileSync(url, 'utf-8');\r\n        callback(content);\r\n    }\r\n\r\n}\r\n\r\ndeclare var wx: any","import { astar } from \"./astar\";\r\nimport { getImage, RenderableBehaviour, SerilizeField, propertyEditor_None } from \"./gameengine\";\r\nexport class TileMapRenderer extends RenderableBehaviour {\r\n\r\n\r\n    @SerilizeField(propertyEditor_None)\r\n    tileData: number[][] = [];\r\n\r\n    grid: astar.Grid;\r\n\r\n    onStart() {\r\n        this.displayObject.renderNode = this;\r\n        this.grid = new astar.Grid(6, 4);\r\n\r\n        for (let rowIndex = 0; rowIndex < this.tileData.length; rowIndex++) {\r\n            const row = this.tileData[rowIndex];\r\n            for (let colIndex = 0; colIndex < row.length; colIndex++) {\r\n                const walkable = row[colIndex] == 1 ? false : true;\r\n                this.grid.setWalkable(colIndex, rowIndex, walkable)\r\n            }\r\n        }\r\n    }\r\n    onUpdate() {\r\n    }\r\n\r\n    onRender(context: CanvasRenderingContext2D) {\r\n        for (let rowIndex = 0; rowIndex < this.tileData.length; rowIndex++) {\r\n            const row = this.tileData[rowIndex];\r\n            for (let colIndex = 0; colIndex < row.length; colIndex++) {\r\n                const data = row[colIndex];\r\n                const imageUrl = `assets/${data}.png`;\r\n                const image = getImage(imageUrl);\r\n                context.drawImage(image, colIndex * 64, rowIndex * 64);\r\n            }\r\n        }\r\n    }\r\n\r\n\r\n    getRenderArea() {\r\n        return {\r\n            x: 0,\r\n            y: 0,\r\n            width: this.grid.numCols * 64,\r\n            height: this.grid.numRows * 64\r\n        }\r\n    }\r\n}","import { Item } from \"./item\";\r\n\r\nexport class User {\r\n\r\n    name: string = \"\";\r\n\r\n    gold: number = 100;\r\n\r\n    bag: Item[] = [];\r\n}\r\n\r\n\r\nexport const user = new User();"],"sourceRoot":""}